# Task Model Contract

**Feature**: 001-add-task
**Date**: 2025-12-06
**Type**: Data Model Contract

---

## Overview

This contract defines the Task data model interface and validation rules. All components that create, manipulate, or validate Task entities must adhere to this contract.

---

## Task Entity Contract

### Type Definition

```python
from dataclasses import dataclass
from datetime import datetime
from typing import Optional

@dataclass
class Task:
    """Task entity contract."""
    id: int
    title: str
    description: Optional[str]
    completed: bool
    created_at: datetime
```

### Field Contracts

#### `id: int`
- **Type**: `int` (positive integer)
- **Range**: `1` to `2^31 - 1`
- **Uniqueness**: MUST be unique within TaskList
- **Generation**: Auto-generated by TaskList
- **Mutability**: Immutable after creation
- **Validation**: None (internal field)

#### `title: str`
- **Type**: `str` (UTF-8 encoded)
- **Required**: YES
- **Min Length**: 1 character (after strip)
- **Max Length**: 200 characters
- **Validation**: `validate_title(title: str) -> tuple[bool, str]`
- **Constraints**:
  - MUST NOT be empty string
  - MUST NOT be whitespace-only
  - Whitespace trimmed before storage
  - Supports Unicode (emoji, international characters)

**Examples**:
```python
# Valid
"Buy groceries"
"Complete project report ðŸ“"
"å­¦ä¹ ä¸­æ–‡"

# Invalid
""  # Empty
"   "  # Whitespace only
"a" * 201  # Too long
```

#### `description: Optional[str]`
- **Type**: `Optional[str]` (UTF-8 encoded or None)
- **Required**: NO
- **Default**: `None`
- **Max Length**: 1000 characters
- **Validation**: `validate_description(description: Optional[str]) -> tuple[bool, str]`
- **Constraints**:
  - CAN be `None` or empty string
  - Supports Unicode
  - No trimming applied

**Examples**:
```python
# Valid
None
""
"Buy milk, eggs, and bread from the store"
"Project details: " + "x" * 980  # Up to 1000 chars

# Invalid
"x" * 1001  # Too long
```

#### `completed: bool`
- **Type**: `bool`
- **Required**: YES
- **Default**: `False` for new tasks
- **Mutability**: Mutable (via Mark Complete feature)
- **Validation**: Type check only

#### `created_at: datetime`
- **Type**: `datetime` (Python datetime object)
- **Required**: YES
- **Timezone**: UTC (timezone-aware or naive UTC)
- **Generation**: Auto-generated at creation time
- **Mutability**: Immutable after creation
- **Format**: ISO 8601 for serialization
- **Precision**: Microseconds

**Examples**:
```python
from datetime import datetime, timezone

# Valid
datetime.utcnow()  # Naive UTC
datetime.now(timezone.utc)  # Timezone-aware UTC

# Display format
"2025-12-06T10:30:00"  # ISO 8601
```

---

## Validation Contract

### Validator Function Signatures

```python
def validate_title(title: str) -> tuple[bool, str]:
    """
    Validate task title.

    Args:
        title: The title string to validate

    Returns:
        (True, "") if valid
        (False, error_message) if invalid

    Contract:
        - MUST return tuple of (bool, str)
        - Error message MUST be non-empty when invalid
        - MUST check type, emptiness, and length
        - MUST strip whitespace before length check
    """
    pass


def validate_description(description: Optional[str]) -> tuple[bool, str]:
    """
    Validate task description.

    Args:
        description: The description string or None

    Returns:
        (True, "") if valid
        (False, error_message) if invalid

    Contract:
        - MUST return tuple of (bool, str)
        - MUST accept None as valid
        - MUST check type and length
        - MUST NOT strip whitespace
    """
    pass
```

### Error Message Contract

Error messages MUST:
- Be user-friendly and actionable
- Not expose internal implementation details
- Be consistent across the application
- Follow the format: `"[Field] [problem] [constraint]"`

**Standard Error Messages**:
```python
VALIDATION_ERRORS = {
    "title_empty": "Title cannot be empty",
    "title_too_long": "Title cannot exceed 200 characters",
    "title_invalid_type": "Title must be a string",
    "description_too_long": "Description cannot exceed 1000 characters",
    "description_invalid_type": "Description must be a string",
}
```

---

## TaskList Contract

### Interface

```python
from typing import List, Optional

class TaskList:
    """TaskList interface contract."""

    def add_task(self, title: str, description: Optional[str] = None) -> Task:
        """
        Create and add a new task.

        Args:
            title: Task title (pre-validated)
            description: Optional task description (pre-validated)

        Returns:
            Newly created Task with auto-generated id and created_at

        Raises:
            No exceptions (validation done before calling)

        Contract:
            - MUST generate unique sequential ID
            - MUST set created_at to current UTC time
            - MUST set completed to False
            - MUST increment internal ID counter
            - MUST add task to internal collection
            - MUST NOT modify title or description
        """
        pass

    def get_all_tasks(self) -> List[Task]:
        """
        Retrieve all tasks.

        Returns:
            List of all tasks (defensive copy)

        Contract:
            - MUST return a new list (not internal reference)
            - MUST preserve insertion order
            - MUST return empty list if no tasks exist
            - MUST NOT return None
        """
        pass

    def get_task_by_id(self, task_id: int) -> Optional[Task]:
        """
        Find task by ID.

        Args:
            task_id: The task ID to search for

        Returns:
            Task if found, None if not found

        Contract:
            - MUST return None for non-existent IDs
            - MUST NOT raise exceptions
            - MUST return actual Task object (not copy)
        """
        pass
```

---

## Serialization Contract

### JSON Schema (Phase II)

```json
{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "type": "object",
  "required": ["id", "title", "completed", "created_at"],
  "properties": {
    "id": {
      "type": "integer",
      "minimum": 1
    },
    "title": {
      "type": "string",
      "minLength": 1,
      "maxLength": 200
    },
    "description": {
      "type": ["string", "null"],
      "maxLength": 1000
    },
    "completed": {
      "type": "boolean"
    },
    "created_at": {
      "type": "string",
      "format": "date-time"
    }
  }
}
```

### Example JSON Output

```json
{
  "id": 1,
  "title": "Buy groceries",
  "description": "Milk, eggs, bread",
  "completed": false,
  "created_at": "2025-12-06T10:30:00"
}
```

---

## Testing Contract

### Minimum Test Coverage

**Unit Tests** (Task Model):
- âœ… Create task with all fields
- âœ… Create task with title only (description=None)
- âœ… Dataclass equality
- âœ… String representation

**Unit Tests** (Validation):
- âœ… Title: valid, empty, whitespace-only, too long, boundary (200 chars)
- âœ… Description: None, valid, empty, too long, boundary (1000 chars)
- âœ… Error messages match contract

**Unit Tests** (TaskList):
- âœ… Add task increments ID
- âœ… Add multiple tasks have unique IDs
- âœ… Get all tasks returns copy
- âœ… Get task by ID found
- âœ… Get task by ID not found returns None

**Contract Tests**:
- âœ… Validator function signatures match contract
- âœ… Error messages match VALIDATION_ERRORS
- âœ… TaskList interface methods exist
- âœ… Return types match annotations

---

## Invariants

The following invariants MUST hold at all times:

1. **ID Uniqueness**: `len(tasks) == len(set(t.id for t in tasks))`
2. **ID Sequence**: `all(t.id >= 1 for t in tasks)`
3. **Title Non-Empty**: `all(t.title.strip() for t in tasks)`
4. **Title Length**: `all(len(t.title) <= 200 for t in tasks)`
5. **Description Length**: `all(t.description is None or len(t.description) <= 1000 for t in tasks)`
6. **Completed Type**: `all(isinstance(t.completed, bool) for t in tasks)`
7. **Created At Type**: `all(isinstance(t.created_at, datetime) for t in tasks)`

---

## Breaking Changes

Changes that break this contract:

- âŒ Changing field names
- âŒ Changing field types
- âŒ Removing required fields
- âŒ Changing validation constraints (length limits)
- âŒ Changing ID generation strategy
- âŒ Changing error message format

Non-breaking changes:

- âœ… Adding optional fields
- âœ… Relaxing validation constraints
- âœ… Adding new methods to TaskList
- âœ… Improving error messages (keeping format)

---

**Status**: Contract Defined
**Version**: 1.0.0
**Last Updated**: 2025-12-06
