# Implementation Plan: Mark Task Complete Feature

**Branch**: `005-mark-complete` | **Date**: 2025-12-06 | **Spec**: [spec.md](./spec.md)
**Input**: Feature specification from `/specs/005-mark-complete/spec.md`

---

## Summary

Implement completion status operations for the todo app, allowing users to mark tasks as complete and reopen them. This feature extends the existing Task and TaskList entities from 001-add-task with two new methods (`mark_complete()` and `unmark_complete()`) and integrates new menu options into the CLI.

**Technical Approach**: Extend TaskList with completion status methods, add CLI handlers for mark complete/reopen operations, and implement two-phase validation (task existence + status check). Operations are idempotent and preserve all task fields except `completed` and `updated_at`.

---

## Technical Context

**Language/Version**: Python 3.13+
**Primary Dependencies**: datetime (stdlib, UTC timezone support), dataclasses
**Storage**: In-memory list (Phase I constraint)
**Testing**: pytest with capsys fixture for CLI testing
**Target Platform**: Console application (Windows/Linux/macOS)
**Project Type**: Single project (console app)
**Performance Goals**: <1 second for status changes (in-memory operations)
**Constraints**: No file persistence, single-user, no completion history
**Scale/Scope**: 5 basic operations (add, delete, update, view, mark complete)

---

## Constitution Check

*GATE: Must pass before Phase 0 research. Re-check after Phase 1 design.*

### I. Spec-Driven Development ✅
- Specification complete with user scenarios, functional requirements, success criteria
- All FR-XXX requirements defined with MUST statements
- Edge cases documented (9 total)

### II. Test-Driven Development ✅
- TDD workflow planned: Write tests → Verify fail (red) → Implement (green) → Refactor
- Unit tests defined for TaskList methods
- Integration tests defined for CLI workflows
- Property-based testing recommended for mark/unmark roundtrips

### III. Evolutionary Architecture ✅
- Builds on existing Task and TaskList from 001-add-task (reuse, not rebuild)
- Minimal changes: Only 2 new methods on TaskList
- Evolution path documented for Phase II (file), Phase IV (database)
- No breaking changes to existing features

### IV. Clean Code & Python Standards ✅
- Type hints required: `Tuple[bool, str]` return types
- Docstrings planned for all methods
- PEP 8 style compliance
- Functions single-purpose (<20 lines per constitution guideline)

### V. Project Structure & Organization ✅
- Planning artifacts in `specs/005-mark-complete/`
- Tests organized: `tests/unit/` and `tests/integration/`
- Source code extends existing structure: `src/models/`, `src/cli/`

### VI. Simplicity First (YAGNI) ✅
- Boolean `completed` field (simplest representation for Phase I)
- No premature optimization (O(n) search acceptable for in-memory)
- No completion history tracking (deferred to future phases)
- No bulk operations (not requested)

### VII. Comprehensive Documentation ✅
- Research.md: 8 technical decisions documented
- Data-model.md: Entity extensions with state machine
- Contracts: 3 contract files (methods, CLI, validation)
- Quickstart.md: Developer guide with TDD workflow
- PHR to be created after planning

**GATE STATUS**: ✅ PASS - All constitution principles satisfied

---

## Project Structure

### Documentation (this feature)

```text
specs/005-mark-complete/
├── spec.md                           # Feature requirements
├── plan.md                           # This file
├── research.md                       # Phase 0: Technical decisions
├── data-model.md                     # Phase 1: Entity extensions
├── quickstart.md                     # Phase 1: Developer guide
├── contracts/                        # Phase 1: API contracts
│   ├── tasklist_completion_methods.md     # mark_complete/unmark methods
│   ├── cli_mark_complete_handler.md       # CLI handlers
│   └── completion_validation.md           # Validation functions
├── checklists/
│   └── requirements.md              # Spec quality validation (PASS)
└── tasks.md                         # Phase 2: Generated by /sp.tasks (NOT YET CREATED)
```

### Source Code (repository root)

```text
src/
├── models/
│   ├── task.py           # Task entity (from 001-add-task, NO CHANGES)
│   └── tasklist.py       # TaskList class (EXTEND with mark_complete/unmark methods)
├── services/
│   └── validation.py     # Validation functions (NEW - optional extraction)
└── cli/
    ├── menu.py           # Main menu (UPDATE with options 5 & 6)
    └── handlers.py       # CLI handlers (ADD handle_mark_complete, handle_reopen_task)

tests/
├── unit/
│   ├── test_tasklist_completion.py    # NEW - TaskList method tests
│   └── test_validation.py             # NEW - Validation function tests (if extracted)
└── integration/
    └── test_cli_mark_complete.py      # NEW - CLI workflow tests
```

**Structure Decision**: Single project structure. Console application with models/services/cli separation. No changes to existing file organization - new code integrates seamlessly with 001-add-task foundation.

---

## Complexity Tracking

> **Fill ONLY if Constitution Check has violations that must be justified**

**No violations**. All complexity justified by Phase I constraints and constitution principles.

---

## Next Steps

**Immediate** (after planning):
1. Run `/sp.tasks mark complete feature` to generate ordered task breakdown
2. Review `quickstart.md` for implementation guide
3. Set up test files based on templates in quickstart

**Ready for Implementation**: Yes
